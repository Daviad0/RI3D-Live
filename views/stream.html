<html>
    <head>
        <style>
            @font-face {
                font-family: 'Cooper Hewitt';
                src: url('public/CooperHewitt-Bold.ttf');
            }

            @font-face {
                font-family: 'Avenir Next';
                font-weight: 500;
                src: url('public/AvenirNextLTPro-Regular.otf');
            }

            @font-face {
                font-family: 'Avenir Next';
                font-weight: 700;
                src: url('public/AvenirNextLTPro-Bold.otf');
            }

            *{
                transition: all 0.5s ease;
            }

            body{
                overflow: hidden;
            }

            span{
                font-family: 'Avenir Next';
                display:block;
                margin: 0;
                line-height: 90%;
            }

            .flex-center{
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .time-left-container{
                position: absolute;
                bottom: 30px;
                right: 30px;
            }

            .top-bar-mtu-apply{
                position: absolute;
                top: 20px;
                right: 20px;
                color: black;
                font-size: 28px;
            }

            .bottom-bar-mtu-logo{
                position: absolute;
                bottom: 2%;
                left: 30px;
                color: black;
                height: 7%;
            }

            .top-bar-image{
                position: absolute;
                top: -20px;
                left: -20px;
                width: calc(100% + 40px);
            }

            .bottom-bar-image{
                position: absolute;
                bottom: -20px;
                left: -20px;
                width: calc(100% + 40px);
            }

            .time-left{
                color: white;
                font-size: 120px;
                
                text-shadow: -2px 2px 0 #000,
                         2px 2px 0 #000,
                         2px -2px 0 #000,
                         -2px -2px 0 #000;
                text-align:right;
            }

            .time-left-label{
                font-size: 40px;
                color: black;
                text-align:right;
            }

            .clock-image{
                position: absolute;
                top: 20px;
                left: 20px;
                max-width:10%;
            }

            .timer-sprawl{
                position: absolute;
                bottom: 0;
                right: 0;
            }

            .gracious-support{
                height: 15%;
                width: 31%;
                position: absolute;
                bottom: 0;
                right: 0;

                display: flex;
                justify-content: center;
                align-items: center;
                

                text-align: center;
            }

            .timer-block{
                width: 18%;
                height: 17%;
                /* background-color: red; */
                position: absolute;
                top: 0;
                right: 0;

                display: flex;
                justify-content: center;
                align-items: center;
                

                text-align: center;

            }

            .timer-block .time{
                font-size: 4em;
                color: black;
                font-weight: 700;
            }

            .timer-block .left{
                font-size: 2em;
                color: black;
                text-align: right;
                font-weight: 700;
                margin-right: 10px;
                margin-top:4px;
            }
            .college-logo{
                width: 280px;
                margin: 15px;
                margin-top:20px;
            }

            .ccr-logo{
                width: 300px;
                margin: 15px;
            }

            .data-segment{
                width: 27%;
                height: 5%;
                /* background-color: red; */
                position: absolute;
                bottom: 10%;
                right: 30%;

                display: flex;
                justify-content: center;
                align-items: center;
                

                text-align: center;

                transition: all 0.5s ease;
            }

            .scrolling-data{
                width: 50%;
                height: 9%;
                /* background-color: red; */
                position: absolute;
                bottom:1%;
                left: 16%;
                display: flex;
                justify-content: center;
                align-items: center;
            }

       


            .scrolling-data span{
                color: white;
                font-size: 1.7em;
                font-weight: 500;
            }

            .data-segment span{
                color: black;
                font-size: 1.7em;
                font-weight: 700;
            }

            .full-screen-image{
                min-width: 100%;
                min-height: 100%;
                position: absolute;
                top: 0;
                left: 0;
                max-width: 120%;

            }

            .top-waiting-bar{
                background-color: rgba(0,0,0,0.7);
                height: 22%;
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;

                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center;
            }

            .full-screen-logos{
                background-image: url('public/BackgroundControl.png');
                height: 100%;
                width: 100%;
                position: absolute;
                top: 0;
                left: 0;

                display: flex;
                justify-content: center;
                align-items: center;
            }

            .full-screen-container{
                background-color: white;
                padding: 10px 80px;
                border-radius: 60px;
            }

            .full-screen-logos img{
                width: 400px;
                margin: 40px;
            }

            .expand-support{
                position: absolute;
                overflow: hidden;
                transition: all 0.75s ease;
                opacity: 0;
            }

            .expand-support.expanded{
                opacity: 1;
            }

            .ad{

            }

            .ad .statement{
                position: absolute;
                bottom: 40px;
                left: 50%;
                transform: translateX(-50%);

                font-size: 3em;
                color: black;
                font-weight: bold;
            }

            .ad .time{
                position: absolute;
                bottom: 20px;
                left: 20px;
                font-size: 2em;
                color: black;
            }
           
            .ad video{
                position: absolute;
                top: 5%;
                left: 10%;
                width: 80%;

                border-radius: 20px;

                transition: all 0.5s ease;

            }

            .webcam video{
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;

                object-fit: cover;
            }

        </style>

        <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    </head>

    <img src="public/Aurora_20230912-01.jpeg" class="full-screen-image" style="opacity: 0;"> 
        <div class="webcam">
        </div>
        <div class="top-waiting-bar" style="opacity: 0;">
            <div>
                <span style="color:white; font-size: 3em;"><strong>Robot in 3 Days at Michigan Tech</strong> is currently on break!</span>
                <span style="color:white; font-size: 5em;font-weight:700;margin-top: 30px" id="time-break"></span>
            </div>
        </div>
        <img src="public/TopBar.png" class="top-bar-image">
        <!-- <span class="top-bar-mtu-apply">mtu.edu/apply</span> -->
        
        <img src="public/RI3DClockOnly.png" id="clock-image" class="clock-image">
        <!-- <img src="Clock.png" class="timer-sprawl"> -->
        <!-- <div class="time-left-container">
            <span class="time-left" id="time-left">00:00:00</span>
            <span class="time-left-label">Remaining</span>
        </div> -->
        <img src="public/DataBar.png" class="bottom-bar-image data-bar" id="data-segment-bar"/>
        <img src="public/BottomBar.png" id="bottom-bar" class="bottom-bar-image"/>
        <img src="public/FullName_Horizontal_OneColor_White.png" class="bottom-bar-mtu-logo">
        
        

        <div class="timer-block">
            <div>
                <span class="time" id="time">00:00:00</span>
                <span class="left">remaining</span>
            </div>
            
        </div>
        <div class="gracious-support">
            <div class="expand-support expanded" id="sponsors">
                <span style="color:white; font-size: 2em;margin-top:20px;text-decoration: underline;">Graciously Supported By</span>
                <div class="flex-center">
                    <img src="public/computing[mtu]-white.png" class="college-logo">
                    <img src="public/MTUeng_white.png" class="college-logo">
                </div>
            </div>

            <div class="expand-support" id="hosts">
                <img src="public/CCRAtMTU.png" class="ccr-logo">
            </div>

            <div class="expand-support" id="build-stage">
                <span style="color:white;font-size:3em">Build Stage: Build</span>
            </div>
            
        </div>
        <div class="data-segment" id="data-segment-info">
            <span>Scots Scored: 0</span>
        </div>


        <div class="scrolling-data">
            <marquee behavior="scroll" direction="left">
                <span id="scrolling-text">This is a testing piece of text.</span>
            </marquee>
        </div>


        <!-- <div class="build-stage">
            <span>Build Stage: Build</span>
        </div> -->

        <div class="full-screen-logos" style="opacity: 0;">
            <div class="flex-center full-screen-container">
                <img src="public/FullName_Horizontal_OneColor_Black.png"/>
                <img src="public/RI3DClockOnly.png"/>
            </div>
            
        </div>

        <div id="ad-view" class="ad">
            <span class="time" id="ad-time">0s</span>
            <span class="statement">We'll Be Right Back...</span>
            <video src="" onended="onVideoEnd()" id="ad-video" autoplay></video>
        </div>
        <script>

            const socket = io('', {path: '/live/socket.io'});

            let stream_state = {};

            let current_support_panel = "sponsors";

            let data_segment_name = "Scots Scored:";

            let data = {
                counter: 0,
                timer: "0:00",
                points: 0
            }

            let advertisements = [
                "public/videos/Brand 60 Broadcast_1.mp4",
                "public/videos/Analise 30 Broadcast_1.mp4",
                "public/videos/Austin Analise 30 Broadcast_1.mp4",
                "public/videos/Analise 15 Broadcast_1.mp4",
                "public/videos/Austin 15 Broadcast_1.mp4",
                "public/videos/Austin 30 Broadcast_1.mp4"

            ]


            // stages = camera, away, full-screen

            let stage = "camera";

            let camera_specific_classes = [
                "data-segment",
                "data-bar",
                "top-bar-image",
                "timer-block",
                "bottom-bar-mtu-logo",
                "gracious-support",
                "scrolling-data"
            ]

            let away_specific_classes = [
                "full-screen-image",
                "top-waiting-bar",
                "bottom-bar-image",
                "bottom-bar-mtu-logo",
                "gracious-support",
                "scrolling-data"
            ]

            let full_screen_specific_classes = [
                "full-screen-logos"
            ]

            let ad_specific_classes = [
                "ad",
                "full-screen-logos"
            ]

            let webcam_specific_classes = [
                "webcam",
                "top-waiting-bar",
                "bottom-bar-image",
                "bottom-bar-mtu-logo",
                "gracious-support",
                "scrolling-data"
            ]

            function changeStage(){
                if(current_support_panel == "sponsors"){
                    document.getElementById('sponsors').classList.remove('expanded');
                    document.getElementById('hosts').classList.add('expanded');
                    document.getElementById('build-stage').classList.remove('expanded');
                    current_support_panel = "hosts";
                }else if(current_support_panel == "hosts"){
                    document.getElementById('hosts').classList.remove('expanded');
                    document.getElementById('sponsors').classList.add('expanded');
                    document.getElementById('build-stage').classList.remove('expanded');
                    current_support_panel = "build-stage";
                }else if(current_support_panel == "build-stage"){
                    document.getElementById('hosts').classList.remove('expanded');
                    document.getElementById('sponsors').classList.remove('expanded');
                    document.getElementById('build-stage').classList.add('expanded');
                    current_support_panel = "sponsors";
                }
            }

            setInterval(() => {
                changeStage();
            }, 8000);


            function setStage(newStage){
                stage = newStage;
                if(stage == "camera"){
                    webcam_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 1;
                    })

                    away_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    full_screen_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    ad_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    camera_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 1;
                    });

                    document.getElementById('bottom-bar').style.opacity = 1;
                    document.getElementById('clock-image').style.opacity = 1;
                }else if(stage == "away"){
                    camera_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    webcam_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    full_screen_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    ad_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    away_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 1;
                    })

                    document.getElementById('bottom-bar').style.opacity = 0.7;
                    document.getElementById('clock-image').style.opacity = 0.4;

                }else if(stage == "full-screen"){
                    camera_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    away_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })


                    webcam_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })
                    

                    ad_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    full_screen_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 1;
                    })

                    document.getElementById('bottom-bar').style.opacity = 0;
                    document.getElementById('clock-image').style.opacity = 0;
                }else if(stage == "ad"){
                    camera_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    away_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    webcam_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    full_screen_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    ad_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 1;
                    })

                    document.getElementById('bottom-bar').style.opacity = 0;
                    document.getElementById('clock-image').style.opacity = 0;

                    setTimeout(() => {
                        chooseNewVideo();
                    }, 1000);


                }else if(stage == "webcam"){
                    camera_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    away_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    full_screen_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    ad_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 0;
                    })

                    webcam_specific_classes.forEach((className) => {
                        document.getElementsByClassName(className)[0].style.opacity = 1;
                    })

                    document.getElementById('bottom-bar').style.opacity = 0.7;
                    document.getElementById('clock-image').style.opacity = 0.4;

                }
            }

            function updateAdTime(){
                let timeElem = document.getElementById('ad-time');
                let video = document.getElementById('ad-video');

                // put time left into the element

                let timeLeft = video.duration - video.currentTime;

                let minutes = Math.floor(timeLeft / 60);

                let seconds = Math.floor(timeLeft % 60);

                timeElem.innerText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
            }

            setInterval(() => {
                if(stage == "ad"){
                    updateAdTime();
                }
            }, 300);

            function onVideoEnd(){
                setStage("full-screen");

                stream_state["stream_view"] = "hide";

                socket.emit('new-stream-state', stream_state);

                let videoElem = document.getElementById('ad-video');
                videoElem.src = "";
                videoElem.removeEventListener('ended', onVideoEnd);
            }

            function chooseNewVideo(){
                let randomIndex = Math.floor(Math.random() * advertisements.length);
                let newAd = advertisements[randomIndex];

                document.getElementById('ad-video').src = newAd;

                
            }

            function updateTimeLeft(){

                let streamTimeTarget = stream_state["time_target"];
                let defaultTimeTarget = "11/12/2024 12:00";

                let targetDate = new Date(defaultTimeTarget);

                if(streamTimeTarget){
                    targetDate = new Date(streamTimeTarget);
                }

                
                let now = new Date();

                let timeLeft = targetDate - now;

                let seconds = Math.floor(timeLeft / 1000);

                let minutes = Math.floor(seconds / 60);

                let hours = Math.floor(seconds / 3600);

                minutes = minutes - (hours * 60);

                seconds = seconds - (minutes * 60) - (hours * 3600);

                let timeLeftString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;



                document.getElementById('time').innerText = timeLeftString;
                document.getElementById('time-break').innerText = timeLeftString;

            }

            setInterval(() => {
                updateTimeLeft();

            }, 300)

            document.addEventListener('keydown', (event) => {
                if(event.key == "1"){
                    setStage("camera");
                }else if(event.key == "2"){
                    setStage("away");
                }else if(event.key == "3"){
                    setStage("full-screen");
                }else if(event.key == "4"){
                    setStage("ad");
                }else if(event.key == "5"){
                    setStage("webcam");
                }
            });

            function handleStreamStateData(){
                if(!stream_state["stream_view"]) return;

                let stream_view = stream_state["stream_view"].toLowerCase();
                if(stream_view == "timer"){
                    setStage("camera");
                }else if(stream_view == "away"){
                    setStage("away");
                }else if(stream_view == "hide"){
                    setStage("full-screen");
                }else if(stream_view == "ad"){
                    setStage("ad");
                }else if(stream_view == "webcam"){
                    setStage("webcam");
                }

                let scrolling_text = stream_state["scrolling_text"];
                document.getElementById('scrolling-text').innerText = scrolling_text;

                

                let data_name = stream_state["data_name"];
                data_segment_name = data_name;

                let build_stage = stream_state["build_stage"];
                document.getElementById('build-stage').getElementsByTagName('span')[0].innerText = `Build Stage: ${build_stage}`;


            }

            function updateDataSegment(){
                let data_segment_elem = document.getElementById('data-segment-info');
                let use_data = null;

                let data_segment = stream_state["data_segment"].toLowerCase();
                if(data_segment == "hidden"){
                    document.getElementById('data-segment-info').style.opacity = 0;
                    document.getElementById('data-segment-bar').style.opacity = 0;
                }else if(data_segment == "timer"){
                    document.getElementById('data-segment-info').style.opacity = stream_state["stream_view"] == "timer" ? 1 : 0;
                    document.getElementById('data-segment-bar').style.opacity = stream_state["stream_view"] == "timer" ? 1 : 0;
                    use_data = data["timer"];

                }else if(data_segment == "counter"){
                    document.getElementById('data-segment-info').style.opacity = stream_state["stream_view"] == "timer" ? 1 : 0;
                    document.getElementById('data-segment-bar').style.opacity = stream_state["stream_view"] == "timer" ? 1 : 0;
                    use_data = data["counter"];

                }else if(data_segment == "points"){
                    document.getElementById('data-segment-info').style.opacity = stream_state["stream_view"] == "timer" ? 1 : 0;
                    document.getElementById('data-segment-bar').style.opacity = stream_state["stream_view"] == "timer" ? 1 : 0;
                    use_data = data["points"] + "pts";

                }

                if(use_data != null){
                    data_segment_elem.getElementsByTagName('span')[0].innerText = `${data_segment_name} ${use_data}`;
                }


                
            }

            setInterval(() => {
                updateDataSegment();
            }, 300);

            socket.on('connect', () => {
                console.log("Connected to server");
            });

            socket.on('stream-state', (data) => {
                stream_state = data;
                handleStreamStateData();
            });

            socket.on('data-state', (dataPassed) => {
                data = dataPassed;
            });
        </script>
    </body>
</html>